<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Quản lý kho phụ tùng</title>

    <!-- Thư viện UI -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
    <link href="../css/style.css" rel="stylesheet" />

    <style>
      .stats-grid { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 16px; }
      .stat-card { background: #fff; border: 0; border-radius: 14px; padding: 18px; box-shadow: 0 8px 18px rgba(0,0,0,0.06); }
      .stat-icon { font-size: 28px; color: var(--primary, #1976d2); }
      .stat-title { color: #6c757d; font-weight: 600; margin-top: 6px; }
      .stat-value { font-size: 26px; font-weight: 700; }
      .chart-card, .card.border-0.shadow-sm { border-radius: 14px; }
      .table-responsive.rounded-3 { border: 1px solid #e9ecef; border-radius: 12px; }
      @media (max-width: 992px) { .stats-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
      @media (max-width: 576px) { .stats-grid { grid-template-columns: 1fr; } }
      .placeholder-glow .placeholder { display:inline-block; height:1em; background:#e9ecef; border-radius:.25rem; }
    </style>
  </head>

  <body>
    <nav class="mobile-bottom-nav d-lg-none">
      <a href="./index.html"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
      <a href="./home.html"><i class="bi bi-box"></i><span>Kho</span></a>
      <a href="./stats.html"><i class="bi bi-bar-chart"></i><span>Thống kê</span></a>
      <a href="./payment.html"><i class="bi bi-cash-coin"></i><span>Thanh toán</span></a>
      <a href="./settings.html"><i class="bi bi-gear"></i><span>Cài đặt</span></a>
    </nav>

    <div id="sidebarOverlay" class="sidebar-overlay d-lg-none"></div>

    <aside class="sidebar">
      <div class="sidebar-header d-flex align-items-center mb-4">
        <div class="sidebar-logo">
          <img id="sidebarLogo" src="https://cdn-icons-png.flaticon.com/512/679/679922.png" alt="Logo" />
        </div>
        <h3 class="sidebar-title m-0 ms-2">Kho phụ tùng</h3>
      </div>
      <ul>
        <li><a href="index.html" class="active"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
        <li><a href="home.html"><i class="bi bi-box"></i> Quản lý kho</a></li>
        <li><a href="stats.html"><i class="bi bi-bar-chart"></i> Thống kê</a></li>
        <li><a href="payment.html"><i class="bi bi-cash-coin"></i> Thanh toán</a></li>
        <li><a href="settings.html"><i class="bi bi-gear"></i> Cài đặt</a></li>
      </ul>
    </aside>

    <main class="main container py-4">
      <div class="dashboard-header mb-3 d-flex align-items-center justify-content-between">
        <div>
          <h2><i class="bi bi-bar-chart-line me-2"></i> Tổng quan hoạt động</h2>
          <div class="text-muted small">Cập nhật: <span id="lastUpdated">—</span></div>
        </div>

        <div class="d-flex gap-2">
          <button id="btnExportCSV" class="btn btn-outline-success btn-sm"><i class="bi bi-file-earmark-arrow-down"></i> Xuất CSV</button>
          <button id="btnDownloadChart" class="btn btn-outline-secondary btn-sm"><i class="bi bi-image"></i> Tải chart</button>
          <button id="btnRefresh" class="btn btn-outline-primary btn-sm"><i class="bi bi-arrow-clockwise"></i> Làm mới</button>
        </div>
      </div>

      <div class="stats-grid" id="kpiGrid">
        <div class="stat-card animate__animated animate__fadeInUp">
          <div class="stat-icon"><i class="bi bi-box-seam"></i></div>
          <div class="stat-title">Tổng sản phẩm</div>
          <div class="stat-value" id="totalProducts"><span class="placeholder-glow"><span class="placeholder col-6"></span></span></div>
        </div>

        <div class="stat-card animate__animated animate__fadeInUp animate__delay-1s">
          <div class="stat-icon"><i class="bi bi-cash-stack"></i></div>
          <div class="stat-title">Doanh thu tháng</div>
          <div class="stat-value" id="monthlyRevenue"><span class="placeholder-glow"><span class="placeholder col-8"></span></span></div>
        </div>

        <div class="stat-card animate__animated animate__fadeInUp animate__delay-2s">
          <div class="stat-icon"><i class="bi bi-truck"></i></div>
          <div class="stat-title">Hãng phổ biến</div>
          <div class="stat-value" id="topBrand"><span class="placeholder-glow"><span class="placeholder col-5"></span></span></div>
        </div>

        <div class="stat-card animate__animated animate__fadeInUp animate__delay-3s">
          <div class="stat-icon"><i class="bi bi-person-check"></i></div>
          <div class="stat-title">Khách hàng mới</div>
          <div class="stat-value" id="newCustomers"><span class="placeholder-glow"><span class="placeholder col-4"></span></span></div>
        </div>
      </div>

      <div class="alert alert-warning d-flex align-items-center justify-content-between mt-3" role="alert">
        <div>
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <strong id="lowStockCount">0</strong> mặt hàng sắp hết (dưới <span id="lowThresholdView">5</span>)
        </div>
        <div>
          <button id="btnSetThreshold" class="btn btn-sm btn-outline-warning me-2"><i class="bi bi-sliders"></i> Thay ngưỡng</button>
          <a href="settings.html#low-stock" class="btn btn-sm btn-outline-dark">Cài đặt</a>
        </div>
      </div>

      <div class="card chart-card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="mb-3"><i class="bi bi-graph-up-arrow me-2"></i> Doanh thu theo tháng</h5>
          <canvas id="overviewChart" height="120"></canvas>
        </div>
      </div>

      <div class="card border-0 shadow-sm mt-3">
        <div class="card-body">
          <h5 class="mb-3"><i class="bi bi-clipboard2-check me-2"></i> Top 5 mặt hàng tồn thấp</h5>
          <div class="table-responsive rounded-3">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr><th>#</th><th>Ảnh</th><th>Tên</th><th>Hãng</th><th>Dòng</th><th>Loại</th><th>Tồn</th></tr>
              </thead>
              <tbody id="topLowStockBody">
                <tr><td colspan="7" class="text-muted text-center py-3">Đang tải...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <!-- Toast container -->
    <div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index:1100">
      <div id="toastContainer" class="toast-container text-center"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/index.js"></script>
  </body>
</html>
